---
description: >-
  Help developers to move from v2 to v3. Please read carefully and integrate the
  following breaking changes to ensure a smooth update.
---

# Upgrade to v3

## Breaking changes

### Cors configuration

Set CORS `credentials: true` if you're using custom CORS configuration. See [how to configure CORS headers](../../setup/configuring-cors-headers.md).

{% tabs %}
{% tab title="Rails" %}
We use the [Rack CORS](https://github.com/cyu/rack-cors) Gem for this purpose.

{% code title="Gemfile" %}
```ruby
# Gemfile
source 'https://rubygems.org'

# ...

gem 'forest_liana'
gem 'rack-cors'
```
{% endcode %}

{% code title="/config/application.rb" %}
```ruby
module LiveDemoRails
  class Application < Rails::Application
    # ...

    # For Rails 5, use the class Rack::Cors. For Rails 4, you MUST use the string 'Rack::Cors'.
    config.middleware.insert_before 0, Rack::Cors do
      allow do
        origins 'app.forestadmin.com'
        resource '*',
          headers: :any,
          methods: :any,
          expose: ['Content-Disposition'],
          credentials: true
      end
    end
  end
end
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Global smart action

Smart actions defined as follows `global: true` will no longer be considered as global.&#x20;

Please now use `type: 'global'`.

{% tabs %}
{% tab title="Rails" %}
**Before**

{% code title="lib/forest_liana/collections/product.rb" %}
```ruby
class Forest::Product
  include ForestLiana::Collection

  collection :Product

  action 'Import data',
    global: true

  # ...
end
```
{% endcode %}

**After**

{% code title="lib/forest_liana/collections/product.rb" %}
```ruby
class Forest::Product
  include ForestLiana::Collection

  collection :Product

  action 'Import data',
    type: 'global'

  # ...
end
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Schema versioning

On server start - _only in development environments_ - the agent will generate a `.forestadmin-schema.json` file reflecting your **Forest Admin schema**.

If you change your models or database, Forest Admin will automatically load a new schema to keep the layout up to date.

{% hint style="danger" %}
**Do not edit this file**. It will be automatically generated on server start **only in development environments**.

This file **must be deployed** for any remote environment (staging, production, etc.), as it will be used to generate your Forest Admin UI.
{% endhint %}

{% hint style="info" %}
**Version this file.** It will give you more visibility on the changes detected by Forest Admin.
{% endhint %}

In the following example, we have added two fields on the `invoices` table:

* `emailSent`
* `quadernoId`

Versioning the`.forestadmin-schema.json` file allows you to easily visualize the changes.

![.forestadmin-schema.json versioning example](../../../.gitbook/assets/versioning.png)

## Changelogs

This release note covers only the major changes. To learn more, please refer to the changelogs in our different repositories:

* [Rails changelog](https://github.com/ForestAdmin/forest-rails/blob/master/CHANGELOG.md#release-300---2019-04-22)
